(()=>{"use strict";const t=class{constructor(t,e){this.name=t,this.length=e,this.numOfHits=0,this.sunk=!1,this.shipArr=this.createShipArr()}createShipArr(){let t=[];for(let e=0;e<this.length;e++)t.push({hit:!1});return t}hit(t){this.numOfHits++,this.shipArr[t].hit=!0}isSunk(){return this.numOfHits===this.length&&(this.sunk=!0),this.sunk}},e=class{constructor(){this.board=this.makeBoard(),this.missedAttacks=[],this.attackedCoords=[]}makeBoard(){let t=[],e=[];for(let r=0;r<10;r++){for(let t=0;t<10;t++)e.push("");t.push(e),e=[]}return t}isPlaceShipValid(t,e,r){if(e>10||e<0||e+t>10||r>10||r<0)return!1;for(let a=e;a<e+t;a++)if(""!==this.board[r][a])return!1;return!0}placeShip(t,e,r){if(this.isPlaceShipValid(t.length,e,r))for(let a=0;a<t.length;a++)this.board[r][e+a]={name:t,id:a}}receiveAttack(t,e){if(!this.attackedCoords.some((r=>r.x===t&&r.y===e))){if(""!==this.board[e][t]){let r=this.board[e][t].name,a=this.board[e][t].id;r.hit(a)}else this.missedAttacks.push({x:t,y:e});this.attackedCoords.push({x:t,y:e})}}allSunk(...t){let e=0;return t.forEach((t=>{t.isSunk()&&e++})),5===e}},r=class{constructor(t){this.name=t,this.turn=!0}getName(){return this.name}startTurn(){this.turn||(this.turn=!0)}endTurn(t){this.turn&&(this.turn=!1,t.startTurn())}checkTurn(){return this.turn}attack(t,e,r){this.checkTurn()&&r.receiveAttack(t,e)}},a=class extends r{constructor(){super(),this.name="Computer",this.turn=!1}};function s(){const s=new r("Chris"),n=new a,i=new e,o=new e;S("battlefieldPlayer"),S("battlefieldOpponent");const l=new t("submarine",2),c=new t("cruiser",3),d=new t("destroyer",4),h=new t("battleship",4),u=new t("carrier",5);g(l),g(c),g(d),g(h),g(u);const p=new t("submarine",2),m=new t("cruiser",3),f=new t("destroyer",4),y=new t("battleship",4),b=new t("carrier",5);function g(t){const e=document.querySelector(".ships"),r=document.createElement("div");r.classList.add("ship"),r.setAttribute("draggable",!0),r.setAttribute("id",t.name);for(let e=0;e<t.length;e++){const t=document.createElement("div");t.classList.add("block"),r.appendChild(t)}r.addEventListener("dragstart",q),e.appendChild(r)}function S(t){const e=document.querySelector(`#${t} > .grid`);for(let r=0;r<10;r++)for(let a=0;a<10;a++){const s=document.createElement("div");s.classList.add("grid-square"),s.setAttribute("data-x",a),s.setAttribute("data-y",r),"battlefieldPlayer"===t?(s.addEventListener("dragover",(t=>{t.preventDefault()})),s.addEventListener("drop",(t=>{t.preventDefault(),C(t)}))):"battlefieldOpponent"===t&&e.parentElement.classList.add("opacity"),e.appendChild(s)}}function k(t){let e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());for(;!o.isPlaceShipValid(t.length,e,r);)e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());o.placeShip(t,e,r)}function C(t){const e=t.dataTransfer.getData("text"),r=parseInt(t.target.getAttribute("data-x")),a=parseInt(t.target.getAttribute("data-y")),s=document.querySelector(".ships"),n=document.querySelector("#battlefieldPlayer > .grid");switch(e){case"submarine":if(i.isPlaceShipValid(l.length,r,a)){i.placeShip(l,r,a);var o=s.querySelector(`#${e}`);for(let t=0;t<l.length;t++){const e=n.querySelector(`[data-x='${r+t}'][data-y='${a}']`);e.style.backgroundColor="var(--ship-color)",e.style.borderColor="rgb(41, 41, 41)"}s.removeChild(o)}break;case"cruiser":if(i.isPlaceShipValid(c.length,r,a)){i.placeShip(c,r,a),o=s.querySelector(`#${e}`);for(let t=0;t<c.length;t++){const e=n.querySelector(`[data-x='${r+t}'][data-y='${a}']`);e.style.backgroundColor="var(--ship-color)",e.style.borderColor="rgb(41, 41, 41)"}s.removeChild(o)}break;case"destroyer":if(i.isPlaceShipValid(d.length,r,a)){i.placeShip(d,r,a),o=s.querySelector(`#${e}`);for(let t=0;t<d.length;t++){const e=n.querySelector(`[data-x='${r+t}'][data-y='${a}']`);e.style.backgroundColor="var(--ship-color)",e.style.borderColor="rgb(41, 41, 41)"}s.removeChild(o)}break;case"battleship":if(i.isPlaceShipValid(h.length,r,a)){i.placeShip(h,r,a),o=s.querySelector(`#${e}`);for(let t=0;t<h.length;t++){const e=n.querySelector(`[data-x='${r+t}'][data-y='${a}']`);e.style.backgroundColor="var(--ship-color)",e.style.borderColor="rgb(41, 41, 41)"}s.removeChild(o)}break;case"carrier":if(i.isPlaceShipValid(u.length,r,a)){i.placeShip(u,r,a),o=s.querySelector(`#${e}`);for(let t=0;t<u.length;t++){const e=n.querySelector(`[data-x='${r+t}'][data-y='${a}']`);e.style.backgroundColor="var(--ship-color)",e.style.borderColor="rgb(41, 41, 41)"}s.removeChild(o)}}0===s.childElementCount&&v()}function v(){const t=document.querySelector("#battlefieldOpponent > .grid"),e=document.querySelector("#battlefieldPlayer > .grid"),r=document.querySelector(".turn"),a=s.checkTurn()?s:n,g=s.checkTurn()?o:i;r.textContent=`${a.getName()}'s Turn...`,a===s&&(t.parentElement.classList.remove("opacity"),e.parentElement.classList.add("opacity"),t.addEventListener("click",(function e(s){const i=parseInt(s.target.dataset.x),l=parseInt(s.target.dataset.y);t.removeEventListener("click",e),g.attackedCoords.some((t=>t.x===i&&t.y===l))?v():(a.attack(i,l,g),$("battlefieldOpponent",o),g.allSunk(p,m,f,y,b)?x(a,r):(a.endTurn(n),v()))}))),a===n&&(t.parentElement.classList.add("opacity"),e.parentElement.classList.remove("opacity"),setTimeout((()=>{const t=Math.floor(10*Math.random()),e=Math.floor(10*Math.random());g.attackedCoords.some((r=>r.x===t&&r.y===e))?v():(a.attack(t,e,g),$("battlefieldPlayer",i),g.allSunk(l,c,d,h,u)?x(a,r):(a.endTurn(s),v()))}),1e3))}function x(t,e){e.textContent=`${t.getName()} is the winner!`}function $(t,e){const r=document.querySelector(`#${t} > .grid`),a=e.board,s=e.missedAttacks;a.forEach(((t,e)=>{t.forEach(((t,a)=>{if(t.name&&!0===t.name.shipArr[t.id].hit){let t=r.querySelector(`[data-x='${a}'][data-y='${e}']`);t.classList.add("hit"),t.textContent="X"}}))})),s.forEach((t=>{let e=r.querySelector(`[data-x='${t.x}'][data-y='${t.y}']`);e.classList.add("missed"),e.textContent="X"}))}function q(t){t.dataTransfer.setData("text/plain",t.target.id)}k(p),k(m),k(f),k(y),k(b)}document.addEventListener("DOMContentLoaded",(()=>{s()}))})();